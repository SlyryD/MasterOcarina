using mzxrules.Helper;
using mzxrules.OcaLib;
using System;
using System.Collections.Generic;

#if DEBUG
namespace Spectrum
{
    partial class Program
    {
        static class BetaQuest
        {
            public enum Ver
            {
                V1_0,
                V1_6
            }
            public static Ver Version = Ver.V1_6;
            public static int GetTBL_OFFSET()
            {
                switch (Version)
                {
                    case Ver.V1_0: return 0x15E8;
                    case Ver.V1_6: return 0x15EC;
                    default: return 0;
                }
            }

            public static int GetSHUFFLE()
            {
                switch (Version)
                {
                    case Ver.V1_0: return 282;
                    case Ver.V1_6: return 281;
                    default: return 0;
                }
            }

            public static short[] GetVAR_Entrances()
            {
                switch (Version)
                {
                    case Ver.V1_0: return VAR_Entrances1_0;
                    case Ver.V1_6: return VAR_Entrances1_6;
                    default: return new short[] { };
                }
            }

            static readonly short[] VAR_Entrances1_6 =
            {
                0x0371,
                0x04BE,
                0x0588,
                0x04C2,
                0x0578,
                0x0315,
                0x0394,
                0x0482,
                0x057C,
                0x0340,
                0x0000,
                0x0004,
                0x0008,
                0x000C,
                0x0010,
                0x0028,
                0x002D,
                0x0033,
                0x0037,
                0x003B,
                0x0043,
                0x004B,
                0x004F,
                0x0053,
                0x0063,
                0x0067,
                0x0072,
                0x007A,
                0x007E,
                0x0082,
                0x0088,
                0x008D,
                0x0098,
                0x009C,
                0x00AD,
                0x00B1,
                0x00B7,
                0x00BB,
                0x00C1,
                0x00C5,
                0x00C9,
                0x00CD,
                0x00DB,
                0x00E4,
                0x00EA,
                0x00FC,
                0x0102,
                0x0108,
                0x010E,
                0x0117,
                0x011E,
                0x0123,
                0x0129,
                0x0130,
                0x0134,
                0x0138,
                0x013D,
                0x0147,
                0x014D,
                0x0157,
                0x0165,
                0x0169,
                0x016D,
                0x0171,
                0x0179,
                0x017D,
                0x0181,
                0x0185,
                0x0189,
                0x018D,
                0x0191,
                0x0195,
                0x019D,
                0x01A1,
                0x01A9,
                0x01B5,
                0x01B9,
                0x01BD,
                0x01C1,
                0x01C9,
                0x01CD,
                0x01D1,
                0x01D5,
                0x01D9,
                0x01DD,
                0x01E1,
                0x01E5,
                0x01E9,
                0x01F1,
                0x01F9,
                0x01FD,
                0x0201,
                0x0205,
                0x0209,
                0x020D,
                0x0211,
                0x0215,
                0x0219,
                0x021D,
                0x0221,
                0x0225,
                0x022D,
                0x0231,
                0x0235,
                0x0239,
                0x023D,
                0x0242,
                0x0246,
                0x024A,
                0x0252,
                0x0256,
                0x025A,
                0x025E,
                0x0262,
                0x0266,
                0x026A,
                0x026E,
                0x0272,
                0x0276,
                0x027E,
                0x0286,
                0x028A,
                0x028E,
                0x0292,
                0x0296,
                0x029A,
                0x029E,
                0x02A2,
                0x02A6,
                0x02AA,
                0x02BA,
                0x02BE,
                0x02C2,
                0x02C6,
                0x02CA,
                0x02D2,
                0x02D6,
                0x02DA,
                0x02DE,
                0x02F9,
                0x02FD,
                0x0301,
                0x0305,
                0x0309,
                0x030D,
                0x0311,
                0x031C,
                0x0328,
                0x032C,
                0x0330,
                0x0334,
                0x033C,
                0x0345,
                0x0349,
                0x034D,
                0x0351,
                0x0355,
                0x0359,
                0x035D,
                0x0361,
                0x0365,
                0x0378,
                0x037C,
                0x0380,
                0x0384,
                0x0388,
                0x038C,
                0x0398,
                0x039C,
                0x03A0,
                0x03A4,
                0x03A8,
                0x03AC,
                0x03B0,
                0x03B8,
                0x03BC,
                0x03C0,
                0x03C4,
                0x03CC,
                0x03D0,
                0x03D4,
                0x03DC,
                0x03E0,
                0x03E4,
                0x03EC,
                0x03F0,
                0x03F4,
                0x03FC,
                0x0400,
                0x040B,
                0x040F,
                0x0413,
                0x0417,
                0x041B,
                0x041F,
                0x042F,
                0x0433,
                0x0437,
                0x043B,
                0x043F,
                0x0443,
                0x0447,
                0x044B,
                0x044F,
                0x0453,
                0x045B,
                0x045F,
                0x0463,
                0x0467,
                0x0472,
                0x047E,
                0x0486,
                0x048A,
                0x048E,
                0x0492,
                0x0496,
                0x049A,
                0x049E,
                0x04A2,
                0x04A6,
                0x04AA,
                0x04AE,
                0x04B2,
                0x04B6,
                0x04BA,
                0x04D6,
                0x04DA,
                0x04DE,
                0x04E2,
                0x04E6,
                0x04EE,
                0x04F6,
                0x04FA,
                0x04FF,
                0x0507,
                0x050B,
                0x051C,
                0x0524,
                0x0528,
                0x052C,
                0x0530,
                0x0534,
                0x0538,
                0x053C,
                0x0540,
                0x0544,
                0x0548,
                0x054C,
                0x0550,
                0x0554,
                0x0560,
                0x0564,
                0x0568,
                0x056C,
                0x0570,
                0x0580,
                0x05C8,
                0x05D0,
                0x05D4,
                0x05DC,
                0x05E0,
                0x05F4,
                0x0600,
                0x0604,
                0x0608,
                0x060C,
                0x0610,
                0x0598,
                0x059C,
                0x05A0,
                0x05A4,
                0x05A8,
                0x05AC,
                0x05B0,
                0x05B4,
                0x05B8,
                0x05BC,
                0x05C0,
                0x05C4,
                0x05FC,
                0x003F,
                0x036D,
                0x00EE,
                0x0153,
                0x0175,
                0x01A5,
                0x01AD,
                0x01ED,
                0x01F5,
                0x024E,
                0x02B2,
                0x02CE,
                0x02E2,
                0x02E6,
                0x02F5,
                0x0320,
                0x0324,
                0x0390,
                0x03B4,
                0x0423,
                0x0457,
                0x0476,
                0x047A,
                0x04C6,
                0x0503,
                0x050F,
                0x0513,
                0x0558,
                0x055C,
                0x0574,
                0x0584,
                0x058C,
                0x0590,
                0x0594,
                0x05CC,
                0x05EC,
                0x05F8,
                0x00A0,
                0x006B,
                0x02AE,
                0x04CA,
                0x04CE,
                0x0517,
                0x05E4,
                0x05E8,
                0x05F0
            };

            static readonly short[] VAR_Entrances1_0 =
            {
                0x0371,
                0x04BE,
                0x0588,
                0x04C2,
                0x0578,
                0x0394,
                0x0482,
                0x057C,
                0x0340,
                0x0000,
                0x0004,
                0x0008,
                0x000C,
                0x0010,
                0x0028,
                0x002D,
                0x0033,
                0x0037,
                0x003B,
                0x0043,
                0x004B,
                0x004F,
                0x0053,
                0x0063,
                0x0067,
                0x0072,
                0x007A,
                0x007E,
                0x0082,
                0x0088,
                0x008D,
                0x0098,
                0x009C,
                0x00AD,
                0x00B1,
                0x00B7,
                0x00BB,
                0x00C1,
                0x00C5,
                0x00C9,
                0x00CD,
                0x00DB,
                0x00E4,
                0x00EA,
                0x00FC,
                0x0102,
                0x0108,
                0x010E,
                0x0117,
                0x011E,
                0x0123,
                0x0129,
                0x0130,
                0x0134,
                0x0138,
                0x013D,
                0x0147,
                0x014D,
                0x0157,
                0x0165,
                0x0169,
                0x016D,
                0x0171,
                0x0179,
                0x017D,
                0x0181,
                0x0185,
                0x0189,
                0x018D,
                0x0191,
                0x0195,
                0x019D,
                0x01A1,
                0x01A9,
                0x01B5,
                0x01B9,
                0x01BD,
                0x01C1,
                0x01C9,
                0x01CD,
                0x01D1,
                0x01D5,
                0x01D9,
                0x01DD,
                0x01E1,
                0x01E5,
                0x01E9,
                0x01F1,
                0x01F9,
                0x01FD,
                0x0201,
                0x0205,
                0x0209,
                0x020D,
                0x0211,
                0x0215,
                0x0219,
                0x021D,
                0x0221,
                0x0225,
                0x022D,
                0x0231,
                0x0235,
                0x0239,
                0x023D,
                0x0242,
                0x0246,
                0x024A,
                0x0252,
                0x0256,
                0x025A,
                0x025E,
                0x0262,
                0x0266,
                0x026A,
                0x026E,
                0x0272,
                0x0276,
                0x027E,
                0x0286,
                0x028A,
                0x028E,
                0x0292,
                0x0296,
                0x029A,
                0x029E,
                0x02A2,
                0x02A6,
                0x02AA,
                0x02BA,
                0x02BE,
                0x02C2,
                0x02C6,
                0x02CA,
                0x02D2,
                0x02D6,
                0x02DA,
                0x02DE,
                0x02F9,
                0x02FD,
                0x0301,
                0x0305,
                0x0309,
                0x030D,
                0x0311,
                0x031C,
                0x0328,
                0x032C,
                0x0330,
                0x0334,
                0x033C,
                0x0345,
                0x0349,
                0x034D,
                0x0351,
                0x0355,
                0x0359,
                0x035D,
                0x0361,
                0x0365,
                0x0378,
                0x037C,
                0x0380,
                0x0384,
                0x0388,
                0x038C,
                0x0398,
                0x039C,
                0x03A0,
                0x03A4,
                0x03A8,
                0x03AC,
                0x03B0,
                0x03B8,
                0x03BC,
                0x03C0,
                0x03C4,
                0x03CC,
                0x03D0,
                0x03D4,
                0x03DC,
                0x03E0,
                0x03E4,
                0x03EC,
                0x03F0,
                0x03F4,
                0x03FC,
                0x0400,
                0x040B,
                0x040F,
                0x0413,
                0x0417,
                0x041B,
                0x041F,
                0x042F,
                0x0433,
                0x0437,
                0x043B,
                0x043F,
                0x0443,
                0x0447,
                0x044B,
                0x044F,
                0x0453,
                0x045F,
                0x0463,
                0x0467,
                0x0472,
                0x0476,
                0x047E,
                0x0486,
                0x048A,
                0x048E,
                0x0492,
                0x0496,
                0x049A,
                0x049E,
                0x04A2,
                0x04A6,
                0x04AA,
                0x04AE,
                0x04B2,
                0x04B6,
                0x04BA,
                0x04D6,
                0x04DA,
                0x04DE,
                0x04E2,
                0x04E6,
                0x04EE,
                0x04F6,
                0x04FA,
                0x04FF,
                0x0503,
                0x0507,
                0x050B,
                0x050F,
                0x051C,
                0x0524,
                0x0528,
                0x052C,
                0x0530,
                0x0534,
                0x0538,
                0x053C,
                0x0540,
                0x0544,
                0x0548,
                0x054C,
                0x0550,
                0x0554,
                0x0560,
                0x0564,
                0x0568,
                0x056C,
                0x0570,
                0x0580,
                0x05C8,
                0x05D0,
                0x05D4,
                0x05DC,
                0x05E0,
                0x05E4,
                0x05F4,
                0x0600,
                0x0604,
                0x0608,
                0x060C,
                0x0610,
                0x0598,
                0x059C,
                0x05A0,
                0x05A4,
                0x05A8,
                0x05AC,
                0x05B0,
                0x05B4,
                0x05B8,
                0x05BC,
                0x05C0,
                0x05C4,
                0x05FC,
                0x003F,
                0x036D,
                0x00EE,
                0x0153,
                0x0175,
                0x01A5,
                0x01AD,
                0x01ED,
                0x01F5,
                0x024E,
                0x02B2,
                0x02CE,
                0x02E2,
                0x02E6,
                0x02F5,
                0x0315,
                0x0320,
                0x0324,
                0x0390,
                0x03B4,
                0x0423,
                0x0457,
                0x045B,
                0x047A,
                0x04C6,
                0x0513,
                0x0558,
                0x055C,
                0x0574,
                0x0584,
                0x058C,
                0x0590,
                0x0594,
                0x05CC,
                0x05EC,
                0x05F8,
                0x00A0,
                0x006B,
                0x02AE,
                0x04CA,
                0x04CE,
                0x0517,
                0x05E8,
                0x05F0
            };
        }
        
        [SpectrumCommand(
            Name = "beta_v",
            Description = "sets version",
            Cat = SpectrumCommand.Category.Proto,
            Sup = SpectrumCommand.Supported.OoT)]
        [SpectrumCommandSignature(
            Sig = new Tokens[] { Tokens.LITERAL })]
        private static void SetBetaQuestVersion(Arguments args)
        {
            if (Options.Version != ORom.Build.N0)
                return;

            string ver = (string)args[0];

            ver = $"V{ver.Replace('.', '_')}";
            if (Enum.TryParse(ver, out BetaQuest.Ver result))
            {
                BetaQuest.Version = result;
                Console.WriteLine("Version updated.");
            }
            else
            {
                Console.WriteLine("1.0 or 1.6 supported");
            }
        }


        [SpectrumCommand(
            Name = "beta_s",
            Description = "Checks for repeats in beta quest shuffle group",
            Cat = SpectrumCommand.Category.Proto,
            Sup = SpectrumCommand.Supported.OoT)]
        private static void TestBetaQuestShuffleData(Arguments args)
        {
            if (Options.Version != ORom.Build.N0)
                return;
            Ptr staticCtx = SPtr.New(0x11BA00).Deref();
            Ptr shuffleTable = staticCtx.RelOff(BetaQuest.GetTBL_OFFSET());

            Dictionary<short, int> collisions = new Dictionary<short, int>();

            int shuffle = BetaQuest.GetSHUFFLE();
            for (int i = 0; i < shuffle; i++)
            {
                short index = shuffleTable.ReadInt16(i * 2);
                if (collisions.ContainsKey(index))
                {
                    collisions[index] += 1;
                }
                else
                {
                    collisions.Add(index, 1);
                }
            }
            Console.Clear();
            Console.WriteLine("Repeats: ");
            foreach (var item in collisions)
            {
                if (item.Value > 1)
                {
                    Console.WriteLine($"{item.Key:X4} - {item.Value}");
                }
            }
        }

        [SpectrumCommand(
            Name = "beta_ent",
            Description = "Locates Beta Quest entrance",
            Cat = SpectrumCommand.Category.Proto,
            Sup = SpectrumCommand.Supported.OoT)]
        [SpectrumCommandSignature(
            Sig = new Tokens[] { Tokens.HEX_S16 })]
        private static void LocateBetaQuestEntrance(Arguments args)
        {
            if (Options.Version != ORom.Build.N0)
                return;
            Ptr staticCtx = SPtr.New(0x11BA00).Deref();
            Ptr shuffleTable = staticCtx.RelOff(BetaQuest.GetTBL_OFFSET());

            short index = (short)args[0];
            short[] VAR_Entrances = BetaQuest.GetVAR_Entrances();

            for (int i = 0; i < 326; i++)
            {
                var read = shuffleTable.ReadInt16(i * 2);
                if (index == read)
                {
                    Console.WriteLine($"{VAR_Entrances[i]:X4}");
                    return;
                }
            }
            Console.WriteLine("NOT FOUND");
        }
    }
}

#endif